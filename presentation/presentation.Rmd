---
title: "Introduction to data.table"
author: "Meas Meng and Tracey Mangin"
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts] 
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      highlightSpans: false
      countIncrementalSlides: false
      ratio: "16:9"
---

```{r, include = FALSE}
library(tidyverse)
library(data.table)
library(here)

## data files
flight_data <- 'flights14.csv'
hourly_data <- 'epa_ampd_hourly_2019_selected.csv'

## read in files
flight_tbl <- read_csv(here::here("data", flight_data))

flight_dt <- fread(here::here("data", flight_data))

hourly_dt <- fread(here::here("data", hourly_data))

hourly_tbl <- as_tibble(hourly_dt)

```


class: inverse, center, middle
name: background

# Who we are

<hr/>

---

# Hello!

.pull-left[
.center[
```{r echo = FALSE, out.width = '60%'}
knitr::include_graphics("img/measrainsey.png")
```
]

.center[**Meas Meng**]
* Tell us about yourself!
* Blah blah

]


.pull-right[
.center[
```{r echo = FALSE, out.width = '60%'}
knitr::include_graphics("img/traceybit.jpeg")
```
]

.center[**Tracey Mangin**]
* Researcher at emLab (UCSB)
* Use data science to investigate questions related to environmental challenges

]


---

# Motivation

.pull-left[
.center[**What I was expecting**]
]

---

# Motivation

.pull-left[
.center[**What I was expecting**]

.center[
```{r echo = FALSE, out.width = '60%'}
knitr::include_graphics("img/stop.png")
```
]

.center[~7 minutes to check email]
]


---

# Motivation

.pull-left[
.center[**What I was expecting**]

.center[
```{r echo = FALSE, out.width = '60%'}
knitr::include_graphics("img/stop.png")
```
]

.center[~7 minutes to check email]
]

.pull-right[
.center[**What happened...**]
]

---

# Motivation

.pull-left[
.center[**What I was expecting**]

.center[
```{r echo = FALSE, out.width = '60%'}
knitr::include_graphics("img/stop.png")
```
]

.center[~7 minutes to check email]
]

.pull-right[
.center[**What happened...**]


.center[
```{r echo = FALSE, out.width = '60%'}
knitr::include_graphics("img/mindblown.png")
```
]

.center[the data... immediately!]

]

---

# Resources

We used the following resources to build this preso:

- [Data cleaning & wrangling: (2) data.table, Grant McDermott](http://rmarkdown.rstudio.com>)
  -Detailed information and examples

- [Introduction to data.table](https://rdatatable.gitlab.io/data.table/articles/datatable-intro.html#what-is-datatable-1a)
  -A great introduction

- [A data.table and dplyr tour](https://atrebas.github.io/post/2019-03-03-datatable-dplyr/#summarise-data)
  -A resource for examining data.table and dplyr "equivalents"

---

class: inverse, center, middle
name: background

# Intro to data.table

<hr/>

---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.

--

## Why use data.table?
--

* memory efficient


---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.


## Why use data.table?

* memory efficient

    * Trust Grant!

---


# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.


## Why use data.table?

* memory efficient

* fast speed

--
    * If you're used to using dplyr or base r while working with large datasets in R, data.table will feel *fast*.

---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.


## Why use data.table?

* memory efficient

* fast speed

Notes to Meas: I'm having a hard time creating something that show dt being much faster

```{r}
state_dplyr <- function() {
  hourly_tbl %>%
    group_by(STATE, FACILITY_NAME) %>%
    summarise(mean_so2_rate = mean(`SO2_RATE (lbs/mmBtu)`, na.rm = T),
              mean_nox_rate = mean(`NOX_RATE (lbs/mmBtu)`, na.rm = T)) %>%
    ungroup()
}

state_dt <- function() {
  hourly_dt[, .(mean_so2_rate = mean(`SO2_RATE (lbs/mmBtu)`, na.rm = T),
                mean_nox_rate = mean(`NOX_RATE (lbs/mmBtu)`, na.rm = T)),
            by = .(STATE, FACILITY_NAME)]
}

microbenchmark::microbenchmark(state_dplyr(), state_dt(), times = 1)

```

---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.


## Why use data.table?

* memory efficient


* fast speed

--

* concise and consistent syntax: fast to type, fast to read

---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.

--

## Why use data.table?

* memory efficient

* fast speed

* concise and consistent syntax: fast to type, fast to read

```{r echo = FALSE}

flight_tbl %>%
  filter(origin == "EWR") %>%
  group_by(carrier, dest) %>%
  summarise(mean_dep_delay = mean(dep_delay),
            mean_arr_delay = mean(arr_delay))

flight_dt[, .(mean_dep_delay = mean(dep_delay), mean_arr_delay = mean(arr_delay)),
          by = .c(carrier, dest)]

```

---


# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.

--

## Why use data.table?
--
* memory efficient

--
* fast speed

--
* concise and consistent syntax: fast to type, fast to read

---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.

## Why use data.table?

* **concise and consistent syntax: fast to type, fast to read**
* fast speed
* memory efficient

---

# Syntax intro

Add details and examples for:

Go over DT[i, j, by]
(version of grant's slide 14 with tidyverse function equivalents)
(add slides on examples)

i details: filtering
helpers (%like%, %between%, %chin%)

j details: selecting
list() vs .()

by details: grouping

Go over the walrus :=
(LHS:RHS vs functional form)
(:= NULL (remove column)

modifying in place
add examples of when to expect that something is modified in place 

---

# Special symbols

.SD: **S**ubset of **D**ata
include example using less efficient version and .SD version
include tidyverse example https://atrebas.github.io/post/2019-03-03-datatable-dplyr/#summarise-data

.N: number of observations
(tidyverse equivalent n())

---

# Chaining operations

Comparisons of tidyverse vs data.table syntax

---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.

## Why use data.table?

* concise and consistent syntax: fast to type, fast to read
* fast speed
* memory efficient

---

# What is data.table?

data.table provides an enhanced, high-performance version of base R’s data.frame with syntax and feature enhancements for ease of use, convenience and programming speed.

## Why use data.table?

* concise and consistent syntax: fast to type, fast to read
* **fast speed**
* memory efficient

---

# fast speed stuff

fread vs read_csv

compare speed of chained operations

keys

benchmark again (dplyr vs dt vs dt with keys)

merge

write.csv vs fwrite

---

# random cool things

---

# random not so cool things

---

# final thoughts

---




