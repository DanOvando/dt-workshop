---
title: "Eco-data-science data.table workshop"
output: html_notebook

---

### shortcuts

Run Chunk : *Cmd+Shift+Enter*

Insert Chunk : *Cmd+Option+I*

Preview HTML : *Cmd+Shift+K*

# Introduction

## The dataset

# packages

## install packages
```{r}
# install.packages("tidyverse")
# install.packages("data.table")
# install.packages("here)
```

## load package(s)
```{r}
library(data.table)
library(janitor)
```

# read in data

## file names
```{r}
hourly_data     = 'epa_ampd_hourly_2019_selected.csv'
facility_data   = 'facility_01-27-2021_224024745.csv'
```

## read in csv file

read in hourly data:
```{r}
dt = fread(here::here("data", hourly_data))
```


```{r}
dt = clean_names(dt)
```

# basics

```{r}
setkey(dt, ORISPL_CODE, UNITID, OP_DATE, OP_HOUR)
```

## filter rows

### select rows for generators in California (CA)
```{r}
head(dt[STATE=="CA"])
```
### select rows that occurred after july 1, 2019
```{r}
head(dt[OP_DATE > "07-01-2019"])
```
((add examples of like, chin, etc))


## select columns

### select columns by name:
```{r}
head(dt[, .(ORISPL_CODE, UNITID, OP_DATE, OP_HOUR, OP_TIME, `GLOAD (MW)`, `SLOAD (1000lb/hr)`, `SO2_MASS (lbs)`)])
```
### select columns by column number/index
```{r}
head(dt[, c(3:10)])
```
# modify data table

## rename columns

### renaming single columns
```{r}
setnames(dt, "SLOAD (1000lb/hr)", "sload_1000lb_hr")
```

### renaming multiple or multiple columns
```{r}
colnames(dt)
```

```{r}
colnames(dt) = c("state", "facility_name", "orispl_code", "unitid", "op_date", "op_hour", "op_time", "gload_mw", "sload_1000lb_hr", "so2_mass_lb",
                 "so2_mass_measure_flg", "so2_rate_lb_mmbtu", "so2_rate_measure_flg", "nox_rate_lb_mmbtu", "nox_rate_measure_flg", 
                 "nox_mass_lb", "nox_mass_measure_flg", "co2_mass_ton", "co2_mass_measure_flg",
                 "co2_rate_ton_mmbtu", "co2_rate_measure_flg", "heat_input_mmbtu", "fac_id", "unit_id")
head(dt)
```

## reorder rows

### temporarily sorting
```{r}
head(dt[order(-gload_mw)])
```

### setting the dt to an order
```{r}
setorder(dt, orispl_code, na.last = TRUE)
head(dt)
```

for multiple columns:
```{r}
# setorderv(dt, )
```

## summarize/aggregate

### summarize by group(s)

.N

### summarize several columns

### summarize several columns by group(s)

### summarize multiple functions on several columns by group(s)

.SD/.SDcols

## add columns

### add columns by groups

### adding multiple columns
functional form vs the other form (LHS:=RHS)

## replace values

replace NAs
```{r}
dt[is.na(column), column := 'something else']
```

## reshape between long and wide forms

### melt (wide to long)

### dcast (long to wide)

## setkey?

# joining data

## merge

## bind

# Beyond...

How much electricity generation, NOx emissions, SO2 emissions, etc are coming from coal vs natural gas plants?