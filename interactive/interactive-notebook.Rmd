---
title: "Eco-data-science data.table workshop"
output: html_notebook

---

### shortcuts

Run Chunk : *Cmd+Shift+Enter*

Insert Chunk : *Cmd+Option+I*

Preview HTML : *Cmd+Shift+K*

# Introduction

## The dataset

# packages

## install packages
```{r}
# install.packages("data.table")
# install.packages("here")
# install.packages("janitor")
```

## load package(s)
```{r}
library(data.table)
library(janitor)
```

# Read in data

## file names
```{r}
hourly_data     = 'epa_ampd_hourly_2019_selected.csv'
facility_data   = 'facility_01-27-2021_224024745.csv'
```

## read in csv file

Read in hourly data:
```{r}
dt = fread(here::here("data", hourly_data))
```

View first few rows:
```{r}
head(dt)
```
Use the ``janitor`` package to clean up the column names:
```{r}
dt = clean_names(dt)
head(dt)
```

# Basics

```{r}
setkey(dt, orispl_code, unitid, op_date, op_hour)
```

## filter rows

### select rows for generators in California (CA)
```{r}
dt[state=="CA"]
```
### select rows that occurred after july 1, 2019
```{r}
dt[op_date > "07-01-2019"]
```
### Select rows for facilities with the word "Energy" in its name
```{r}
dt[facility_name %like% "Energy"]
```
### Select rows that are within California and New Jersey
```{r}
dt[state %chin% c("CA", "NJ")]
```

## select columns

### select columns by name:
```{r}
head(dt[, .(orispl_code, unitid, op_date, op_hour, op_time, gload_mw)])
```
### select columns by column number/index
```{r}
dt[, c(3:8)]
```
# modify data table

## rename columns

### renaming single columns
```{r}
setnames(dt, "heat_input_mm_btu", "heat_input_mmbtu")
setnames(dt, "so2_rate_lbs_mm_btu", "so2_rate_lbs_mmbtu")
setnames(dt, "nox_rate_lbs_mm_btu", "nox_rate_lbs_mmbtu")
setnames(dt, "co2_rate_tons_mm_btu", "co2_rate_tons_mmbtu")
```

### renaming multiple or multiple columns
```{r}
colnames(dt)
```

## reorder rows

### temporarily sorting
```{r}
dt[order(-gload_mw)]
```

### setting the dt to an order
```{r}
setorder(dt, orispl_code, na.last = TRUE)
head(dt)
```

for multiple columns:
```{r}
setorder(dt, state, orispl_code, unitid, op_date, op_hour)
head(dt)
```

## summarize/aggregate

### summarize by group(s)

.N

### summarize several columns

### summarize several columns by group(s)

### summarize multiple functions on several columns by group(s)

.SD/.SDcols

## add columns

### add columns by groups

### adding multiple columns
functional form vs the other form (LHS:=RHS)

## replace values

replace NAs
```{r}
dt[is.na(column), column := 'something else']
```

## reshape between long and wide forms

### melt (wide to long)

### dcast (long to wide)

## setkey?

# joining data

## merge

## bind

# Beyond...

How much electricity generation, NOx emissions, SO2 emissions, etc are coming from coal vs natural gas plants?